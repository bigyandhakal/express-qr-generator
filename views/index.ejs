<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Your description">
    <meta name="author" content="Your name">

    <!-- OG Meta Tags to improve the way the post looks when you share the page on Facebook, Twitter, LinkedIn -->
    <meta property="og:site_name" content="" /> <!-- website name -->
    <meta property="og:site" content="" /> <!-- website link -->
    <meta property="og:title" content="" /> <!-- title shown in the actual shared post -->
    <meta property="og:description" content="" /> <!-- description shown in the actual shared post -->
    <meta property="og:image" content="" /> <!-- image link, make sure it's jpg -->
    <meta property="og:url" content="" /> <!-- where do you want your post to link to -->
    <meta name="twitter:card" content="summary_large_image"> <!-- to have large image post format in Twitter -->

    <!-- Webpage Title -->
    <title>Mark Webpage Title</title>

    <!-- Styles -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,400&family=Poppins:wght@600&display=swap"
        rel="stylesheet">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/fontawesome-all.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- Favicon  -->
    <link rel="icon" href="images/favicon.png">
</head>

<body data-spy="scroll" data-target=".fixed-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark" style="background: #24262a;">
        <div class="container">

            <!-- Image Logo -->
            <!-- <a class="navbar-brand logo-image" href="/"><img src="images/logo.svg" alt="alternative"></a>   -->
            <a class="navbar-brand logo-image" href="/">QR Code Generator</a>

            <!-- Text Logo - Use this if you don't have a graphic logo -->
            <!-- <a class="navbar-brand logo-text page-scroll" href="index.html">Mark</a> -->

            <button class="navbar-toggler p-0 border-0" type="button" data-toggle="offcanvas">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link page-scroll" href="/">Home <span class="sr-only">(current)</span></a>
                    </li>

                </ul>
            </div> <!-- end of navbar-collapse -->
        </div> <!-- end of container -->
    </nav> <!-- end of navbar -->
    <!-- end of navigation -->

    <!-- Contact -->
    <div id="contact" class="form-1 bg-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h2>Generate your QR code</h2>
                    <p class="p-heading">Create your free QR code and send your code to your email.</a></p>
                </div> <!-- end of col -->
            </div> <!-- end of row -->
            <div class="row">
                <div class="col-lg-12">

                    <!-- Contact Form -->
                    <form id="qrForm">
                        <div class="">
                            <img src="" id="qrImg">
                        </div>
                        <br>
                        <div class="form-group">
                            <input type="text" class="form-control-input" id="qrInput" required>
                            <label class="label-control" for="url">Your QR URL.</label>
                            <br>
                            <button type="button" class="form-control-submit-button"
                                onclick="fetchData(); return false;">Create QR</button>
                        </div>
                        <div>
                            <input type="checkbox" id="check" onclick="showHideDiv();">
                            <label for="check">Send Email</label>
                        </div>
                        <div class="form-group" id="sendEmail" style="display: none;">
                            <input type="email" class="form-control-input" id="email" required>
                            <label class="label-control" for="email">Your email address</label>
                            <br>
                            <button type="button" class="form-control-submit-button"
                                onclick="sendEmailData(); return false;">Send Email</button>
                        </div>
                    </form>
                    <br>
                    <!-- end of contact form -->
                    <div id="msg" style="color: red;">
                    </div>

                </div> <!-- end of col -->
            </div> <!-- end of row -->
        </div> <!-- end of container -->
    </div> <!-- end of form-1 -->
    <!-- end of contact -->


    <!-- Footer -->
    <div class="footer bg-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="social-container">
                        <span class="fa-stack">
                            <a href="#your-link">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-facebook-f fa-stack-1x"></i>
                            </a>
                        </span>
                        <span class="fa-stack">
                            <a href="#your-link">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-twitter fa-stack-1x"></i>
                            </a>
                        </span>
                        <span class="fa-stack">
                            <a href="#your-link">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-pinterest-p fa-stack-1x"></i>
                            </a>
                        </span>
                        <span class="fa-stack">
                            <a href="#your-link">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-instagram fa-stack-1x"></i>
                            </a>
                        </span>
                        <span class="fa-stack">
                            <a href="#your-link">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-youtube fa-stack-1x"></i>
                            </a>
                        </span>
                    </div> <!-- end of social-container -->
                </div> <!-- end of col -->
            </div> <!-- end of row -->
        </div> <!-- end of container -->
    </div> <!-- end of footer -->
    <!-- end of footer -->


    <!-- Copyright -->
    <div class="copyright bg-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <p class="p-small">Copyright Â© <a class="no-line" href="#your-link">Your name</a></p>
                </div> <!-- end of col -->
            </div> <!-- enf of row -->
        </div> <!-- end of container -->

        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <p class="p-small">Distributed By <a class="no-line" href="https://themewagon.com/">Themewagon</a>
                    </p>
                </div> <!-- end of col -->
            </div> <!-- enf of row -->
        </div> <!-- end of container -->

    </div> <!-- end of copyright -->
    <!-- end of copyright -->


    <!-- Scripts -->
    <script src="js/jquery.min.js"></script> <!-- jQuery for Bootstrap's JavaScript plugins -->
    <script src="js/bootstrap.min.js"></script> <!-- Bootstrap framework -->
    <script src="js/jquery.easing.min.js"></script> <!-- jQuery Easing for smooth scrolling between anchors -->
    <script src="js/scripts.js"></script> <!-- Custom scripts -->

    <script>
        var qrData;
        function showHideDiv() {
            const val = document.getElementById("check");
            const showEmail = document.getElementById("sendEmail");

            if (val.checked == true) {
                showEmail.style.display = "block";
            }
            else {
                showEmail.style.display = "none";
            }
        }


        async function fetchData() {
            const qrUrl = document.getElementById("qrInput").value;
            await generateQrCode(qrUrl);
        }
        async function generateQrCode(url) {
            try {
                const response = await fetch("/api/v1/qr", {
                    method: "POST", // or 'PUT'
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ url }),
                });
                const result = await response.json();
                if (result && result.data) {
                    qrData = result.data;
                    document.getElementById("qrImg").src = result.data;
                }
                console.log("Success:", result);
            } catch (error) {
                console.error("Error:", error);
            }
        }

        async function sendEmailData() {
            const email = document.getElementById('email').value;
            console.log(email)
            if (!email || !qrData) {
                document.getElementById("msg").innerText = "QR or Email is Missing"
                return false;
            }
            const payload = { email, qrUrl: qrData };
            await sendEmail(payload);
        }
        async function sendEmail(payload) {
            try {
                const response = await fetch("/api/v1/mail", {
                    method: "POST", // or 'PUT'
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                });
                const result = await response.json();
                if (result && result.data) {
                    document.getElementById("msg").style.color = "green"
                    document.getElementById("msg").innerText = "Email sent successfully"
                }
                setTimeout(()=>{
                    document.getElementById("msg").innerText = ""
                }, 2500)
                document.getElementById("qrForm").reset();
            } catch (error) {
                console.error("Error:", error);
            }
        }
    </script>
</body>

</html>